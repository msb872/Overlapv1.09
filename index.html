<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ø¯Ø±Ø¨Ù†Ø¯ÛŒ Ù‚ÙˆØ·ÛŒ ÙÙ„Ø²ÛŒ</title>
  <style>
    body { font-family: Tahoma, sans-serif; background: linear-gradient(to bottom,#eef2f7,#ffffff); margin:0; padding:6px; color:#333; }
    header { background:#0077b6; color:#fff; padding:2px; border-radius:8px; text-align:center; margin-bottom:10px; }
    .info-text { font-size:12px; text-align:center; margin-bottom:10px; }

    .input-row { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-bottom:8px; }
    .input-row label { font-size:12px; display:flex; flex-direction:column; width:140px; background:#fff; padding:10px; border:1px solid #ccc; border-radius:6px; }
    .input-row input, .input-row select { margin-top:6px; padding:6px 8px; font-size:14px; border:1px solid #bbb; border-radius:4px; }
    .input-row button { align-self:flex-end; background:#0077b6; border:none; color:white; padding:10px 20px; border-radius:6px; cursor:pointer; font-size:14px; margin-top:24px; }
    .input-row button:hover { background:#005f99; }

    .progress-bar-container { width: 90%; max-width: 500px; margin: 10px auto; background: #eee; border-radius: 8px; overflow: hidden; height: 18px; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #0077b6, #00c4cc); transition: width 0.3s; }

    table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; }
    th,td { border:1px solid #555; padding:10px; text-align:center; font-size:14px; }
    th { background:#f0f4f8; font-weight:bold; }

    #warnings { margin-top:20px; }
    #warnings ul { list-style:none; padding:0; }
    #warnings li { background:#fff3f3; border:1px solid #ffcccc; padding:8px 12px; margin-bottom:6px; border-radius:5px; color:#c00; font-size:14px; }

    .footer-buttons { position:fixed; left:25px; bottom:25px; display:flex; flex-direction:column; gap:5px; }
    .footer-buttons button { width:130px; background:#0077b6; border:none; color:#fff; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:14px; }
    .footer-buttons button:hover { background:#005f99; }

    #helpOverlay {
      position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);
      display:flex; justify-content:center; align-items:center; z-index:10000; visibility: hidden;
    }
    #helpBox {
      background:#fff; width: 340px; padding:20px; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.3); text-align:right; font-family: Tahoma;
      animation: popIn 0.3s ease forwards;
    }
    #helpBox h3 { text-align:center; margin-bottom:10px; color:#0077b6; }
    #helpBox ul { padding-right: 20px; font-size:14px; line-height:1.7; }
    #helpBox button {
      background:#0077b6; color:#fff; padding:6px 14px; border:none;
      border-radius:6px; cursor:pointer; display:block; margin: 10px auto 0;
    }
    @keyframes popIn { from { transform: scale(0.7); opacity:0; } to { transform: scale(1); opacity:1; } }

    @media print {
      body * { visibility: hidden; }
      #printArea, #printArea * { visibility: visible; }
      #printArea { position:absolute; left:0; top:0; width:100%; padding:20px; }
    }

    #printHeader {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 14px;
      font-weight: bold;
      border-bottom: 1px solid #999;
      padding-bottom: 8px;
    }
    #printHeader div {
      width: 33%;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body>
<header>
  <h2>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ù‚ÙˆØ·ÛŒ ÙÙ„Ø²ÛŒ v1.09</h2>
</header>

<p class="info-text">ğŸ”¹ ØªÙ…Ø§Ù… Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨Ø± Ø­Ø³Ø¨ <strong>0.001 Ø§ÛŒÙ†Ú†</strong> Ù‡Ø³ØªÙ†Ø¯ ğŸ”¹</p>

<div style="text-align:center; margin-bottom:8px;">
  <label>ğŸ“¦ Ù†ÙˆØ¹ Ø¸Ø±Ù:
    <select id="containerType">
        <option>Ù‚ÙˆØ·ÛŒ 400 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
        <option>Ù‚ÙˆØ·ÛŒ 420 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
        <option>Ù‚ÙˆØ·ÛŒ 770 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
	<option>Ù‚ÙˆØ·ÛŒ 800 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
	<option>Ù‚ÙˆØ·ÛŒ 4000 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
	<option>Ù‚ÙˆØ·ÛŒ 16 Ú©ÛŒÙ„ÙˆÛŒÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
        <option>Ù‚ÙˆØ·ÛŒ 400 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
        <option>Ù‚ÙˆØ·ÛŒ 420 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
        <option>Ù‚ÙˆØ·ÛŒ 770 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
	<option>Ù‚ÙˆØ·ÛŒ 800 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
	<option>Ù‚ÙˆØ·ÛŒ 4000 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
	<option>Ù‚ÙˆØ·ÛŒ 16 Ú©ÛŒÙ„ÙˆÛŒÛŒ Ø³Ø§Ø¯Ù‡</option>
    </select>
  </label>
</div>

<div class="input-row">
  <label>Ø·ÙˆÙ„ Ø¯ÙˆØ®Øª-SL<input type="number" id="length" min="0" step="0.01"></label>
  <label>Ø¶Ø®Ø§Ù…Øª Ø¯ÙˆØ®Øª-ST<input type="number" id="seamThickness" min="0" step="0.01"></label>
  <label>Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨-CH<input type="number" id="coverHook" min="0" step="0.01"></label>
  <label>Ù‚Ù„Ø§Ø¨ Ø¨Ø¯Ù†Ù‡-BH<input type="number" id="bodyHook" min="0" step="0.01"></label>
  <label>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø³Ø±-Te<input type="number" id="headThickness" min="0" step="0.01"></label>
  <label>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø¨Ø¯Ù†Ù‡-Tb<input type="number" id="bodyThickness" min="0" step="0.01"></label>
  <button type="button" onclick="addTemplate()">â• Ù…Ø­Ø§Ø³Ø¨Ù‡/Ø¬Ø¯ÛŒØ¯</button>
</div>

<div class="progress-bar-container">
  <div class="progress-bar" id="progress"></div>
</div>

<div id="printArea">
  <div id="printHeader" style="display:none;">
    <div>ğŸ“… ØªØ§Ø±ÛŒØ® Ø¢Ù†Ø§Ù„ÛŒØ²: <span id="analysisDate"></span></div>
    <div>ğŸ“¦ Ù†ÙˆØ¹ Ø¸Ø±Ù: <span id="containerSelected"></span></div>
    <div>ğŸ‘¤ Ú¯Ø²Ø§Ø±Ø´Ú¯Ø±: <span id="reporterName"></span></div>
  </div>

  <table id="resultsTable">
    <thead>
      <tr id="headerRow"><th>ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</th><th>Ù‚Ø§Ù„Ø¨ 1</th></tr>
    </thead>
    <tbody id="tableBody">
      <tr><td>Ø·ÙˆÙ„ Ø¯ÙˆØ®Øª (Seam Length)</td></tr>
      <tr><td>Ø¶Ø®Ø§Ù…Øª Ø¯ÙˆØ®Øª (Seam Thickness)</td></tr>
      <tr><td>Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨ (Cover Hook)</td></tr>
      <tr><td>Ù‚Ù„Ø§Ø¨ Ø¨Ø¯Ù†Ù‡ (Body Hook)</td></tr>
      <tr><td>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø³Ø± (End Thickness)</td></tr>
      <tr><td>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø¨Ø¯Ù†Ù‡ (Body Thickness)</td></tr>
      <tr><td>Ø§Ø®ØªÙ„Ø§Ù Ù‚Ù„Ø§Ø¨ (Hook Difference)</td></tr>
      <tr><td>ÙØ¶Ø§ÛŒ Ø¢Ø²Ø§Ø¯ (Free Space)</td></tr>
      <tr><td>Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ (Overlap %)</td></tr>
      <tr><td>Ú†Ø±ÙˆÚ©ÛŒØ¯Ú¯ÛŒ Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨</td></tr>
      <tr><td>ØªÛŒØ²Ú©Ø±Ø¯Ú¯ÛŒ Ø¯ÙˆØ®Øª</td></tr>
    </tbody>
  </table>

  <div id="warnings"><strong>âš ï¸ Ù…ÙˆØ§Ø±Ø¯ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ø§ØµÙ„Ø§Ø­:</strong><ul id="warningList"></ul></div>
</div>

<div class="footer-buttons">
  <button onclick="printReport()">ğŸ–¨ï¸ Ù¾Ø±ÛŒÙ†Øª</button>
  <button onclick="exportToExcel()">ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ Excel</button>
  <button onclick="saveAsHTML()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ HTML</button>
  <button onclick="showHelp()">â„¹ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§</button>
</div>

<div id="helpOverlay">
  <div id="helpBox">
    <h3>ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡</h3>
    <ul>
      <li>1ï¸âƒ£ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ Ø¨Ø± Ø­Ø³Ø¨ <b>0.001 Ø§ÛŒÙ†Ú†</b> ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
      <li>2ï¸âƒ£ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ <b>Ù…Ø­Ø§Ø³Ø¨Ù‡/Ø¬Ø¯ÛŒØ¯</b> Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</li>
      <li>3ï¸âƒ£ Ù†ØªØ§ÛŒØ¬ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú†Ø§Ù¾ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯.</li>
      <li>4ï¸âƒ£ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§ØªØŒ Ú©Ù„ÛŒØ¯ <b>F5</b> Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.</li>
      <li>5ï¸âƒ£ Ø§Ú¯Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù„Ø·ÙØ§Ù‹ Ù†Ø¸Ø±ØªØ§Ù† Ø±Ø§ Ø¨Ø§ Ù…Ø§ Ø¯Ø± Ù…ÛŒØ§Ù† Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ âœ…</li>
    </ul>
    <p style="font-size:13px; text-align:center; margin-top:5px;">
      âœï¸ ØªÙ‡ÛŒÙ‡â€ŒÚ©Ù†Ù†Ø¯Ù‡: <b>Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ</b><br>
      ğŸ“ 09173206052<br>
      ğŸ› ï¸ Ù†Ø³Ø®Ù‡ 1.09
    </p>
    <button onclick="hideHelp()">Ø¨Ø³ØªÙ†</button>
  </div>
</div>

<script>
let templateCount=1;

function toMM(v){return v*0.0254;}
function formatVal(v){return v.toFixed(2)+" ("+toMM(v).toFixed(2)+" mm)";}

document.querySelectorAll(".input-row input").forEach(inp=>{
  inp.addEventListener("input",updateProgress);
});

function updateProgress(){
  const inputs=document.querySelectorAll(".input-row input");
  let filled=[...inputs].filter(i=>i.value!=="").length;
  document.getElementById("progress").style.width=(filled/inputs.length*100)+"%";
}

function addTemplate(){
  const ids=['length','seamThickness','coverHook','bodyHook','headThickness','bodyThickness'];
  const raw=ids.map(id=>parseFloat(document.getElementById(id).value));
  if(raw.some(v=>isNaN(v)||v<0)){alert("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return;}

  const [L,ST,CH,BH,Te,Tb]=raw;
  const diff=Math.abs(CH-BH);
  const free=Math.abs(ST-(3*Te+2*Tb));
  const denom=L-(2.2*Te+1.1*Tb);
  let overlap=denom!==0?Math.abs((L-(CH+BH+1.1*Te))/denom*100):0;

  if(templateCount>1){
    const th=document.createElement("th");
    th.textContent="Ù‚Ø§Ù„Ø¨ "+templateCount;
    document.getElementById("headerRow").appendChild(th);
  }

  const vals=[formatVal(L),formatVal(ST),formatVal(CH),formatVal(BH),formatVal(Te),formatVal(Tb),formatVal(diff),formatVal(free),overlap.toFixed(2),"-","-"];
  document.querySelectorAll("#tableBody tr").forEach((r,i)=>{
    const td=document.createElement("td");
    td.textContent=vals[i];
    r.appendChild(td);
  });

  const col=templateCount;
  const rows=document.querySelectorAll("#tableBody tr");
  const warns=[];
  function mark(i,msg){ rows[i].children[col].style.background="#ffd2d2"; warns.push(msg); }

  if(CH<70) mark(2,"Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨ Ú©Ù…ØªØ± Ø§Ø² 70");
  if(BH<70) mark(3,"Ù‚Ù„Ø§Ø¨ Ø¨Ø¯Ù†Ù‡ Ú©Ù…ØªØ± Ø§Ø² 70");
  if(diff>7.8) mark(6,"Ø§Ø®ØªÙ„Ø§Ù Ù‚Ù„Ø§Ø¨ Ø¨ÛŒØ´ØªØ± Ø§Ø² 7.8");
  if(free>7.5) mark(7,"ÙØ¶Ø§ÛŒ Ø¢Ø²Ø§Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 7.5");
  if(overlap<45) mark(8,"Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ú©Ù…ØªØ± Ø§Ø² 45Ùª");
  if(overlap>90) mark(8,"Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ø¨ÛŒØ´ØªØ± Ø§Ø² 90Ùª");

  if(warns.length){
    const li=document.createElement("li");
    li.textContent="Ù‚Ø§Ù„Ø¨ "+col+": "+warns.join("ØŒ ");
    document.getElementById("warningList").appendChild(li);
  }

  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ù‡ Ø¬Ø² Ø¶Ø®Ø§Ù…Øª Ø³Ø± Ùˆ Ø¨Ø¯Ù†Ù‡
  document.getElementById("length").value="";
  document.getElementById("seamThickness").value="";
  document.getElementById("coverHook").value="";
  document.getElementById("bodyHook").value="";
  document.getElementById("length").focus();

  updateProgress();
  templateCount++;
}

function exportToExcel(){
  const html=document.getElementById("resultsTable").outerHTML.replace(/ /g,"%20");
  const a=document.createElement("a");
  a.href=`data:application/vnd.ms-excel,${html}`;
  a.download="ØªØ­Ù„ÛŒÙ„_Ø¯Ø±Ú¯ÛŒØ±ÛŒ.xls";
  document.body.appendChild(a); a.click(); a.remove();
}

function saveAsHTML(){
  const name=prompt("Ù†Ø§Ù… Ú¯Ø²Ø§Ø±Ø´Ú¯Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:","Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ")||"Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ";
  const date=new Date().toLocaleDateString("fa-IR");

  const header=document.getElementById("printHeader");
  header.style.display="flex";
  document.getElementById("reporterName").textContent=name;
  document.getElementById("analysisDate").textContent=date;
  document.getElementById("containerSelected").textContent=document.getElementById("containerType").value;

  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ù…Ù„ HTML Ø¨Ø§ dir="rtl" Ùˆ lang="fa"
  const content = `
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ</title>
  <style>
    body { font-family: Tahoma; direction: rtl; text-align: right; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #555; padding: 6px; text-align: center; }
    th { background: #eef2f7; }
    #printHeader { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; font-weight: bold; }
    #printHeader div { width: 33%; text-align: center; }
  </style>
</head>
<body>
${document.getElementById("printArea").innerHTML}
</body>
</html>
`;

  const blob=new Blob([content],{type:"text/html"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download=`Ú¯Ø²Ø§Ø±Ø´_${date}.html`;
  a.click();
  URL.revokeObjectURL(url);

  header.style.display="none";
}


function printReport(){
  const name=prompt("Ù†Ø§Ù… Ú¯Ø²Ø§Ø±Ø´Ú¯Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:","Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ")||"Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ";
  const date=new Date().toLocaleDateString("fa-IR");

  const header=document.getElementById("printHeader");
  header.style.display="flex";
  document.getElementById("reporterName").textContent=name;
  document.getElementById("analysisDate").textContent=date;
  document.getElementById("containerSelected").textContent=document.getElementById("containerType").value;

  window.print();

  header.style.display="none";
}

function showHelp(){
  document.getElementById("helpOverlay").style.visibility="visible";
}
function hideHelp(){
  document.getElementById("helpOverlay").style.visibility="hidden";
}

// Ø­Ø±Ú©Øª Ø¨ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø§ Enter
const inputs = document.querySelectorAll(".input-row input");
inputs.forEach((input, index) => {
  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±ÙØªØ§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
      if (index + 1 < inputs.length) {
        inputs[index + 1].focus(); // Ø±ÙØªÙ† Ø¨Ù‡ ÙÛŒÙ„Ø¯ Ø¨Ø¹Ø¯ÛŒ
      } else {
        document.querySelector(".input-row button").focus(); // Ø§Ú¯Ø± Ø¢Ø®Ø±ÛŒÙ† ÙÛŒÙ„Ø¯ Ø¨ÙˆØ¯ØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø±ÙˆØ¯
      }
    }
  });
});

</script>
</body>
</html>

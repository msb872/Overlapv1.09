<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ø¯Ø±Ø¨Ù†Ø¯ÛŒ Ù‚ÙˆØ·ÛŒ ÙÙ„Ø²ÛŒ</title>
  <style>
    body { font-family: Tahoma, sans-serif; background: linear-gradient(to bottom,#eef2f7,#ffffff); margin:0; padding:6px; color:#333; }
    header { background:#0077b6; color:#fff; padding:2px; border-radius:8px; text-align:center; margin-bottom:10px; }
    .info-text { font-size:12px; text-align:center; margin-bottom:10px; }

    .input-row { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-bottom:8px; }
    .input-row label { font-size:12px; display:flex; flex-direction:column; width:140px; background:#fff; padding:10px; border:1px solid #ccc; border-radius:6px; }
    .input-row input, .input-row select { margin-top:6px; padding:6px 8px; font-size:14px; border:1px solid #bbb; border-radius:4px; }
    .input-row button { align-self:flex-end; background:#0077b6; border:none; color:white; padding:10px 20px; border-radius:6px; cursor:pointer; font-size:14px; margin-top:24px; }
    .input-row button:hover { background:#005f99; }

    .progress-bar-container { width: 90%; max-width: 500px; margin: 10px auto; background: #eee; border-radius: 8px; overflow: hidden; height: 18px; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #0077b6, #00c4cc); transition: width 0.3s; }

    table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; }
    th,td { border:1px solid #555; padding:10px; text-align:center; font-size:14px; }
    th { background:#f0f4f8; font-weight:bold; }

    #warnings { margin-top:20px; }
    #warnings ul { list-style:none; padding:0; }
    #warnings li { background:#fff3f3; border:1px solid #ffcccc; padding:8px 12px; margin-bottom:6px; border-radius:5px; color:#c00; font-size:14px; }

    .footer-buttons { position:fixed; left:25px; bottom:25px; display:flex; flex-direction:column; gap:5px; }
    .footer-buttons button { width:130px; background:#0077b6; border:none; color:#fff; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:14px; }
    .footer-buttons button:hover { background:#005f99; }

    #helpOverlay {
      position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);
      display:flex; justify-content:center; align-items:center; z-index:10000; visibility: hidden;
    }
    #helpBox {
      background:#fff; width: 340px; padding:20px; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.3); text-align:right; font-family: Tahoma;
      animation: popIn 0.3s ease forwards;
    }
    #helpBox h3 { text-align:center; margin-bottom:10px; color:#0077b6; }
    #helpBox ul { padding-right: 20px; font-size:14px; line-height:1.7; }
    #helpBox button {
      background:#0077b6; color:#fff; padding:6px 14px; border:none;
      border-radius:6px; cursor:pointer; display:block; margin: 10px auto 0;
    }
    @keyframes popIn { from { transform: scale(0.7); opacity:0; } to { transform: scale(1); opacity:1; } }

    @media print {
      body * { visibility: hidden; }
      #printArea, #printArea * { visibility: visible; }
      #printFooter {
        display: block !important;
        visibility: visible !important;
        position: fixed;
        bottom: 0;
        width: 100%;
        text-align: center;
        font-size: 12px;
        border-top: 1px solid #aaa;
        padding: 5px 0;
        background: #fff;
      }
      #printArea {
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
      }
    }

    #printHeader {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 14px;
      font-weight: bold;
      border-bottom: 1px solid #999;
      padding-bottom: 8px;
    }
    #printHeader div { width: 33%; text-align: center; }
  </style>
</head>
<body>

<!-- Ù¾ÛŒØ§Ù… Ø®ÙˆØ´ Ø¢Ù…Ø¯ -->
<div id="welcomeOverlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:11000;">
  <div style="background:#fff;padding:20px;border-radius:12px;max-width:360px;text-align:center;">
    <h2 style="color:#0077b6;margin-bottom:10px;">Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
    <p>Ø§ÛŒÙ† Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± ØªÙˆØ³Ø· <strong>Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ</strong> Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.<br>Â© 2025 Ú©Ù„ÛŒÙ‡ Ø­Ù‚ÙˆÙ‚ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ <strong>ÛŒÚ©â€ŒÙˆÛŒÚ©</strong> Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.</p>
    <button onclick="document.getElementById('welcomeOverlay').style.display='none'" style="background:#0077b6;color:#fff;border:none;padding:8px 20px;border-radius:6px;">Ø´Ø±ÙˆØ¹</button>
  </div>
</div>

<header>
  <h2>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ù‚ÙˆØ·ÛŒ ÙÙ„Ø²ÛŒ v1.09</h2>
</header>

<p class="info-text">ğŸ”¹ ØªÙ…Ø§Ù… Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨Ø± Ø­Ø³Ø¨ <strong>0.001 Ø§ÛŒÙ†Ú†</strong> Ù‡Ø³ØªÙ†Ø¯ ğŸ”¹</p>

<div style="text-align:center; margin-bottom:8px;">
  <label>ğŸ“¦ Ù†ÙˆØ¹ Ø¸Ø±Ù:
    <select id="containerType">
      <option>Ø§Ø§Ù†ØªØ®Ø§Ø¨</option>
      <option>Ù‚ÙˆØ·ÛŒ 400 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
      <option>Ù‚ÙˆØ·ÛŒ 420 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
      <option>Ù‚ÙˆØ·ÛŒ 770 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
      <option>Ù‚ÙˆØ·ÛŒ 800 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
      <option>Ù‚ÙˆØ·ÛŒ 4000 Ú¯Ø±Ù…ÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
      <option>Ù‚ÙˆØ·ÛŒ 16 Ú©ÛŒÙ„ÙˆÛŒÛŒ Ú†Ø§Ù¾Ø¯Ø§Ø±</option>
      <option>Ù‚ÙˆØ·ÛŒ 400 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
      <option>Ù‚ÙˆØ·ÛŒ 420 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
      <option>Ù‚ÙˆØ·ÛŒ 770 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
      <option>Ù‚ÙˆØ·ÛŒ 800 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
      <option>Ù‚ÙˆØ·ÛŒ 4000 Ú¯Ø±Ù…ÛŒ Ø³Ø§Ø¯Ù‡</option>
      <option>Ù‚ÙˆØ·ÛŒ 16 Ú©ÛŒÙ„ÙˆÛŒÛŒ Ø³Ø§Ø¯Ù‡</option>
    </select>
  </label>
</div>

<div class="input-row">
  <label>Ø·ÙˆÙ„ Ø¯ÙˆØ®Øª-SL<input type="number" id="length" min="0" step="0.01"></label>
  <label>Ø¶Ø®Ø§Ù…Øª Ø¯ÙˆØ®Øª-ST<input type="number" id="seamThickness" min="0" step="0.01"></label>
  <label>Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨-CH<input type="number" id="coverHook" min="0" step="0.01"></label>
  <label>Ù‚Ù„Ø§Ø¨ Ø¨Ø¯Ù†Ù‡-BH<input type="number" id="bodyHook" min="0" step="0.01"></label>
  <label>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø³Ø±-Te<input type="number" id="headThickness" min="0" step="0.01"></label>
  <label>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø¨Ø¯Ù†Ù‡-Tb<input type="number" id="bodyThickness" min="0" step="0.01"></label>
  <button type="button" onclick="addTemplate()">â• Ù…Ø­Ø§Ø³Ø¨Ù‡/Ø¬Ø¯ÛŒØ¯</button>
</div>

<div class="progress-bar-container"><div class="progress-bar" id="progress"></div></div>

<div id="printArea">
  <div id="printHeader" style="display:none;">
    <div>ğŸ“… ØªØ§Ø±ÛŒØ® Ø¢Ù†Ø§Ù„ÛŒØ²: <span id="analysisDate"></span></div>
    <div>ğŸ“¦ Ù†ÙˆØ¹ Ø¸Ø±Ù: <span id="containerSelected"></span></div>
    <div>ğŸ‘¤ Ú¯Ø²Ø§Ø±Ø´Ú¯Ø±: <span id="reporterName"></span></div>
  </div>

  <table id="resultsTable">
    <thead><tr id="headerRow"><th>ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</th><th>Ù‚Ø§Ù„Ø¨ 1</th></tr></thead>
    <tbody id="tableBody">
      <tr><td>Ø·ÙˆÙ„ Ø¯ÙˆØ®Øª (Seam Length)</td></tr>
      <tr><td>Ø¶Ø®Ø§Ù…Øª Ø¯ÙˆØ®Øª (Seam Thickness)</td></tr>
      <tr><td>Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨ (Cover Hook)</td></tr>
      <tr><td>Ù‚Ù„Ø§Ø¨ Ø¨Ø¯Ù†Ù‡ (Body Hook)</td></tr>
      <tr><td>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø³Ø± (End Thickness)</td></tr>
      <tr><td>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø¨Ø¯Ù†Ù‡ (Body Thickness)</td></tr>
      <tr><td>Ø§Ø®ØªÙ„Ø§Ù Ù‚Ù„Ø§Ø¨ (Hook Difference)</td></tr>
      <tr><td>ÙØ¶Ø§ÛŒ Ø¢Ø²Ø§Ø¯ (Free Space)</td></tr>
      <tr><td>Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ (Overlap %)</td></tr>
      <tr><td>Ú†Ø±ÙˆÚ©ÛŒØ¯Ú¯ÛŒ Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨</td></tr>
      <tr><td>ØªÛŒØ²Ú©Ø±Ø¯Ú¯ÛŒ Ø¯ÙˆØ®Øª</td></tr>
    </tbody>
  </table>

  <div id="warnings"><strong>âš ï¸ Ù…ØºØ§ÛŒØ±Øª Ù‡Ø§  :</strong><ul id="warningList"></ul></div>
</div>

<div id="printFooter" style="display:none;text-align:center;font-size:12px;color:#666;margin-top:20px;border-top:1px solid #ccc;padding-top:8px;">
  Â© Û²Û°Û²Ûµ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÚ© Ùˆ ÛŒÚ© | Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ
</div>

<div class="footer-buttons">
  <button onclick="printReport()">ğŸ–¨ï¸ Ù¾Ø±ÛŒÙ†Øª</button>
  <button onclick="exportToExcel()">ğŸ“¤ Ø°Ø®ÛŒØ±Ù‡ Excel</button>
  <button onclick="saveAsHTML()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ HTML</button>
  <button onclick="showHelp()">â„¹ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§</button>
</div>

<div id="helpOverlay">
  <div id="helpBox">
    <h4>ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±</h4>
    <ul style="text-align:right;line-height:1.8;font-size:12px;">
      <li>âœ… Ø§ÛŒÙ† Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ <b>Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ø¯ÙˆØ®Øª Ù‚ÙˆØ·ÛŒ ÙÙ„Ø²ÛŒ</b> Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</li>
      <li>ğŸ”¹ Ø§Ø¨ØªØ¯Ø§ <b>Ù†ÙˆØ¹ Ø¸Ø±Ù</b> Ø±Ø§ Ø§Ø² Ù„ÛŒØ³Øª Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</li>
      <li>ğŸ”¹ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø²ÛŒØ± Ø±Ø§ Ø¨Ø± Ø­Ø³Ø¨ <b>0.001 Ø§ÛŒÙ†Ú†</b> ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:
        <ul style="margin-right:20px;font-size:13px;">
          <li>ğŸ”¹ <b>Ø·ÙˆÙ„ Ø¯ÙˆØ®Øª (SL):</b> Ø·ÙˆÙ„ Ù†Ø§Ø­ÛŒÙ‡ Ø¯ÙˆØ®Øª.</li>
          <li>ğŸ”¹ <b>Ø¶Ø®Ø§Ù…Øª Ø¯ÙˆØ®Øª (ST):</b> Ø¶Ø®Ø§Ù…Øª Ú©Ù„ Ø¯ÙˆØ®Øª.</li>
          <li>ğŸ”¹ <b>Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨ (CH):</b> Ù…ÛŒØ²Ø§Ù† Ù‚Ù„Ø§Ø¨ ÙˆØ±Ù‚ Ø¯Ø±Ø¨.</li>
          <li>ğŸ”¹ <b>Ù‚Ù„Ø§Ø¨ Ø¨Ø¯Ù†Ù‡ (BH):</b> Ù…ÛŒØ²Ø§Ù† Ù‚Ù„Ø§Ø¨ ÙˆØ±Ù‚ Ø¨Ø¯Ù†Ù‡.</li>
          <li>ğŸ”¹ <b>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø³Ø± (Te):</b> Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ù‚Ø³Ù…Øª Ø¯Ø±Ø¨.</li>
          <li>ğŸ”¹ <b>Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ø¨Ø¯Ù†Ù‡ (Tb):</b> Ø¶Ø®Ø§Ù…Øª ÙˆØ±Ù‚ Ù‚Ø³Ù…Øª Ø¨Ø¯Ù†Ù‡.</li>
        </ul>
      </li>
      <li>âœ… Ù¾Ø³ Ø§Ø² ØªÚ©Ù…ÛŒÙ„ Ù…Ù‚Ø§Ø¯ÛŒØ±ØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ <b>â• Ù…Ø­Ø§Ø³Ø¨Ù‡/Ø¬Ø¯ÛŒØ¯</b> Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</li>
      <li>ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù‡Ø± Ù‚Ø§Ù„Ø¨ (Template) Ø¯Ø± ÛŒÚ© Ø³ØªÙˆÙ† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</li>
      <li>âš ï¸ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ <b>Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ú©Ù…ØªØ± Ø§Ø² Û´ÛµÙª ÛŒØ§ Ø¨ÛŒØ´ØªØ± Ø§Ø² Û¹Û°Ùª</b Ø¨Ø§Ø´Ø¯ØŒ Ù‡Ø´Ø¯Ø§Ø± Ù‚Ø±Ù…Ø² Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</li>
      <li>ğŸ–¨ï¸ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´ Ø±Ø§ <b>Ú†Ø§Ù¾ Ú©Ù†ÛŒØ¯</b> ÛŒØ§ Ø¨Ø§ ÙØ±Ù…Øª <b>HTML / Excel</b> Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…Ø§ÛŒÛŒØ¯.</li>
      <li>ğŸ¯ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Enter Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø³Ø±ÛŒØ¹â€ŒØªØ± Ø¨ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ Ø­Ø±Ú©Øª Ú©Ù†ÛŒØ¯.</li>
      <li>ğŸ”„ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ØŒ Ú©Ù„ÛŒØ¯ <b>F5</b> Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.</li>
      <li>5ï¸âƒ£ Ø§Ú¯Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù„Ø·ÙØ§Ù‹ Ù†Ø¸Ø±ØªØ§Ù† Ø±Ø§ Ø¨Ø§ Ù…Ø§ Ø¯Ø± Ù…ÛŒØ§Ù† Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ âœ…</li>
    </ul>
    <hr>
    <p style="font-size:12px;text-align:center;margin-top:2px;">
      âœï¸ ØªÙ‡ÛŒÙ‡â€ŒÚ©Ù†Ù†Ø¯Ù‡: <b>Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ Ú©Ø§Ø±Ø´Ù†Ø§Ø³ Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ùˆ Ú©Ù†ØªØ±Ù„ Ú©ÛŒÙÛŒØª</b><br>
      ğŸ“ 09173206052 - 09303661270<br>
      ğŸ­ Â© Û²Û°Û²Ûµ ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª â€“ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÚ©â€Œ Ùˆ ÛŒÚ© Ø¯Ø´Øª Ù…Ø±ØºØ§Ø¨
    </p>
    <button onclick="hideHelp()">Ø¨Ø³ØªÙ†</button>
  </div>
</div>


<script>
let templateCount=1;

function toMM(v){return v*0.0254;}
function formatVal(v){return v.toFixed(2)+" ("+toMM(v).toFixed(2)+" mm)";}

document.querySelectorAll(".input-row input").forEach(inp=>{
  inp.addEventListener("input",updateProgress);
});

function updateProgress(){
  const inputs=document.querySelectorAll(".input-row input");
  let filled=[...inputs].filter(i=>i.value!=="").length;
  document.getElementById("progress").style.width=(filled/inputs.length*100)+"%";
}

function addTemplate(){
  const ids=['length','seamThickness','coverHook','bodyHook','headThickness','bodyThickness'];
  const raw=ids.map(id=>parseFloat(document.getElementById(id).value));
  if(raw.some(v=>isNaN(v)||v<0)){alert("Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return;}

  const [L,ST,CH,BH,Te,Tb]=raw;
  const diff=Math.abs(CH-BH);
  const free=Math.abs(ST-(3*Te+2*Tb));
  const denom=L-(2.2*Te+1.1*Tb);
  let overlap=denom!==0?Math.abs((L-(CH+BH+1.1*Te))/denom*100):0;

  if(templateCount>1){
    const th=document.createElement("th");
    th.textContent="Ù‚Ø§Ù„Ø¨ "+templateCount;
    document.getElementById("headerRow").appendChild(th);
  }

  const vals=[formatVal(L),formatVal(ST),formatVal(CH),formatVal(BH),formatVal(Te),formatVal(Tb),formatVal(diff),formatVal(free),overlap.toFixed(2),"-","-"];
  document.querySelectorAll("#tableBody tr").forEach((r,i)=>{
    const td=document.createElement("td");
    td.textContent=vals[i];
    r.appendChild(td);
  });

  const col=templateCount;
  const rows=document.querySelectorAll("#tableBody tr");
  const warns=[];
  function mark(i,msg){ rows[i].children[col].style.background="#ffd2d2"; warns.push(msg); }

  if(CH<70) mark(2,"Ù‚Ù„Ø§Ø¨ Ø¯Ø±Ø¨ Ú©Ù…ØªØ± Ø§Ø² 70");
  if(BH<70) mark(3,"Ù‚Ù„Ø§Ø¨ Ø¨Ø¯Ù†Ù‡ Ú©Ù…ØªØ± Ø§Ø² 70");
  if(diff>7.8) mark(6,"Ø§Ø®ØªÙ„Ø§Ù Ù‚Ù„Ø§Ø¨ Ø¨ÛŒØ´ØªØ± Ø§Ø² 7.8");
  if(free>7.5) mark(7,"ÙØ¶Ø§ÛŒ Ø¢Ø²Ø§Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 7.5");
  if(overlap<45) mark(8,"Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ú©Ù…ØªØ± Ø§Ø² 45Ùª");
  if(overlap>90) mark(8,"Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ Ø¨ÛŒØ´ØªØ± Ø§Ø² 90Ùª");

  if(warns.length){
    const li=document.createElement("li");
    li.textContent="Ù‚Ø§Ù„Ø¨ "+col+": "+warns.join("ØŒ ");
    document.getElementById("warningList").appendChild(li);
  }

  document.getElementById("length").value="";
  document.getElementById("seamThickness").value="";
  document.getElementById("coverHook").value="";
  document.getElementById("bodyHook").value="";
  document.getElementById("length").focus();

  updateProgress();
  templateCount++;
}

function exportToExcel(){
  const html=document.getElementById("resultsTable").outerHTML.replace(/ /g,"%20");
  const a=document.createElement("a");
  a.href=`data:application/vnd.ms-excel,${html}`;
  a.download="ØªØ­Ù„ÛŒÙ„_Ø¯Ø±Ú¯ÛŒØ±ÛŒ.xls";
  document.body.appendChild(a); a.click(); a.remove();
}

function saveAsHTML(){
  const name=prompt("Ù†Ø§Ù… Ú¯Ø²Ø§Ø±Ø´Ú¯Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:","Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ")||"Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ";
  const date=new Date().toLocaleDateString("fa-IR");

  const header=document.getElementById("printHeader");
  header.style.display="flex";
  document.getElementById("reporterName").textContent=name;
  document.getElementById("analysisDate").textContent=date;
  document.getElementById("containerSelected").textContent=document.getElementById("containerType").value;

  const content = `
<!DOCTYPE html><html lang="fa" dir="rtl"><head><meta charset="UTF-8"><title>Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø±ØµØ¯ Ø¯Ø±Ú¯ÛŒØ±ÛŒ</title>
<style>
body { font-family: Tahoma; direction: rtl; text-align: right; }
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid #555; padding: 6px; text-align: center; }
th { background: #eef2f7; }
#printHeader { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; font-weight: bold; }
#printFooter { text-align:center; margin-top:15px; border-top:1px solid #999; font-size:12px; padding-top:5px;}
</style></head><body>
${document.getElementById("printArea").innerHTML}
<div id="printFooter">Â© Û²Û°Û²Ûµ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÚ©â€ŒÙˆÛŒÚ© | Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ</div>
</body></html>`;

  const blob=new Blob([content],{type:"text/html"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download=`Ú¯Ø²Ø§Ø±Ø´_${date}.html`;
  a.click();
  URL.revokeObjectURL(url);

  header.style.display="none";
}

function printReport(){
  const name=prompt("Ù†Ø§Ù… Ú¯Ø²Ø§Ø±Ø´Ú¯Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:","Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ")||"Ù…Ù‡Ù†Ø¯Ø³ Ø®Ø§Ù†ÛŒ";
  const date=new Date().toLocaleDateString("fa-IR");

  const header=document.getElementById("printHeader");
  header.style.display="flex";
  document.getElementById("reporterName").textContent=name;
  document.getElementById("analysisDate").textContent=date;
  document.getElementById("containerSelected").textContent=document.getElementById("containerType").value;

  document.getElementById("printFooter").style.display="block";
  window.print();
  document.getElementById("printFooter").style.display="none";
  header.style.display="none";
}

function showHelp(){document.getElementById("helpOverlay").style.visibility="visible";}
function hideHelp(){document.getElementById("helpOverlay").style.visibility="hidden";}

// Ø­Ø±Ú©Øª Ø¨Ø§ Enter
const inputs = document.querySelectorAll(".input-row input");
inputs.forEach((input, index) => {
  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      e.preventDefault();
      if (index + 1 < inputs.length) {
        inputs[index + 1].focus();
      } else {
        document.querySelector(".input-row button").focus();
      }
    }
  });
});
</script>
</body>
</html>
